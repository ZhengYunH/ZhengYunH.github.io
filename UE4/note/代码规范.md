# 代码规范

> https://docs.unrealengine.com/4.27/zh-CN/ProductionPipelines/DevelopmentSetup/CodingStandard/
>
> https://github.com/Allar/ue5-style-guide

### 编译

+ 需要保证所有蓝图在编译时0警告和0错误
+ ***绝对不要*** 提交断开的蓝图

### 类组织

类的书写方式应该以读者的阅读顺序进行排列，而不是写的时候的顺序。换句话说，也就是按照public、protected、private的顺序去组织类代码。

### 版权声明

由Epic提供用于分配的源文件（.h、.cpp、.xaml、etc.）必须在文件的首行包含版权声明。版权声明的格式必须严格按照以下形式编写：

```c++
// Copyright Epic Games, Inc. All Rights Reserved.
```

若此行缺失或格式错误，CIS将生成错误或失败提示。

### 变量

变量的命名关乎程序的开发效率，好的命名能够让人在看到变量的时候就清楚其用法，提供有效的信息。变量名的规范能够有效提高代码可读性，让自己和他人更加快速的理解代码。

#### 命名

+ 避免过度缩写
+ PascalCase：所有首字母大写，没有任何连接符 `_`。例如：PlayerScore（正确）/ playerScore（错误） / player_score（错误）
+ 前缀规范：类型名前缀需要额外的大写字母，用于区分和变量的命名
  + 模板类前缀为T：`class TArray`
  + 继承自`UObject`的类前缀为U：`class AIMODULE_API UBehaviorTree : public UObject, public IBlackboardAssetProvider`
  + 继承自 `AActor` 的类前缀为A：`class ENGINE_API APawn : public AActor, public INavAgentInterface`
  + 继承自 `SWidget` 的类前缀为S：`class SLATE_API SRichTextBlock : public SWidget`
  + 抽象类的前缀为I：`class INavAgentInterface`
  + 列举的前缀为E：`enum EBoneAxis`
  + 布尔变量必须以b为前缀：`bPendingDestruction` 或 `bHasFadedIn`
  + 其它大部分类都用F作为前缀，部分子系统用其他字母作为前缀
  + Typedefs应以任何与其类型相符的字母为前缀：若为结构体的Typedefs，则使用F；若为 `Uobject` 的Typedefs，则使用U，以此类推。
    + 特别模板实例化的Typedef不再是模板，并应加上相应前缀，例如： `typedef TArray<FMytype> FArrayOfMyTypes;`
  + C#中省略前缀。
+ 类型和变量的命名为名词
+ 变量逐个声明，以便添加注释
+ bool类型如果用来表示一般信息，应该使用描述性名词，不要使用含有提问含义的词汇，`Is`是保留词汇：
  + bDead（正确）- bIsDead（错误）
  + bHostile（正确）- bIsHostile（错误）
+ 对于复杂状态，不要使用bool类型保存，如果有需要尽量使用enum来代替
  + 例如：定义`class weapon`时，不要使用bReloading、bEquipping，因为reloading和equipping不可能同时存在，应该定义`enum EWeaponState`。
+ 考虑上下文，避免重复、不必要的定义。例如，有个蓝图名为 `BP_PlayerCharacter`：Score（正确）- PlayerScore（错误）；TargetPlayer（正确）- MyTargetPlayer（错误）；Skills（正确）- CharacterSkills（错误）
+ 不要在变量中包含原生变量类型名
  + 原生变量名指的是 bool \ int \ float \ enum \ string \ vector \ list ...。例如： Score（正确）- ScoreFloat（错误）；Description（正确）- DescriptionString（错误）
  + 对于vector或者list的变量，要使用复数形式。例如：Targets（正确）- TargetList（错误）；EnemyPlayers（正确）- EnemyPlayerArray（错误）
+ 变量的访问权限：对于public不用赘述。尽量使用protected，除非十分清楚这个类是不会有继承的或者子类不可能用到时用 private

#### 标记

+ `Editable`
  + 谨慎使用 `Editable` 标记。如果因为某些引擎的原因，可以标为 `Expose On Spawn`
    + 对于可编辑变量在`Tooltip`中填写关于如何改变变量值，会产生何种效果的说明
  + 对于Slider，要确定其合理范围，以免造成效果的错误甚至编辑器的崩溃
    + 基于类中变量的数量，需要进行不同分类
      +  <5：没必要进行分类
      + 5 - 10：所有`Editable`的分量应该有自己的分类，通常叫做 `Config`
      + \>10：添加子分类，例如：`Config | Animations`
+ `Advanced Display`：对于通常不会有人碰到的变量，可以使用`Advanced Display`标记
+ `Transient`：对于不需要序列化的数据，应该标记为 `Transient`
+ `SaveGame`：只有从SaveGame继承的子类中的成员变量才能够使用SaveGame属性，并且确保该变量应该被保存时才把这个属性设置上
  + 绝对**不要**将`SaveGame`和`Transient`同时使用，这是明显不合理的。
+ `Config`：不要使用`Config Variable`这个标记，这会让设计师在控制蓝图行为上更加困难。这个标记一般用在C++中，用来标记那些极少被改变的变量，你可以认为它们是那些被标上`Advanced Advanced Display`的变量

### 函数、事件以及事件派发器

函数、事件以及事件派发器的命名十分重要，使用者能够通过函数的名字去确定函数的类型，作用以及目的，而不需要关注函数内部的具体实现。好的命名能够大大减少不同代码模块之间沟通的成本，提高代码的编写效率。

仅仅从一个名字本身，就有很多条件要考虑，比如说：

- 是纯函数吗（no effect）？
- 是状态查询函数吗?
- 是事件相应函数吗?
- 是远程调用函数吗?
- 函数的目的是什么？

如果命名得当，这些问题甚至更多问题的答案会在名字中体现出来。

#### 命名

+ 避免过度缩写
+ PascalCase：所有首字母大写，没有任何连接符 `_`
+ 函数名是动词，以描述函数的效果或不产生副作用的函数的返回值。例如：`void SetScore(Score);`  或者 `float GetScore();`
  + `OnRep` 这样的相应函数，事件和事件派发器的命名不遵守这个规则
  + 不要用毫无意义的动词，例如 `Process` ， `Handle`
+ 对于属性状态变化的响应函数应该命名为 `OnRep_Variable`
+ 事件的响应函数和派发函数都应该以`On`开头。例如：`OnDeath` ，`OnClick`
+ 远程调用函数应该用目标作为前缀，例如`Server`、 `Client`或者 `Multicast`。例如：`ServerFireWeapon`
+ 对于无返回值的方法，应该强调修改的方式以及被修改的内容。但对于被修改内容本身为方法所在的Object，此时就不需要在方法名中添加被修改内容

+ 对于有返回值的方法，应该描述返回的值：`bool CheckTea(FTea Tea); bool IsTeaFresh(FTea Tea);`
+ 所有返回bool的函数应该发起true/false询问（All functions that return a bool should ask a true/false question）：如`IsVisible()`或`ShouldClearBuffer()`
+ 【建议】若函数参数通过引用传递，同时该值会写入函数，以"Out"做为函数参数命名的前缀。且若In或Out参数同样为布尔，以b作为In/Out的前缀：`void foo(bool& bOutResult)`

### 基本数据类型

- `bool` 代表布尔值（不会假定布尔尺寸）。`BOOL` 不会进行编译。
- `TCHAR` 代表字符（不会假定TCHAR尺寸)。
- `uint8` 代表无符号字节（1字节）。
- `int8` 代表带符号字节（1字节）。
- `uint16` 代表无符号"短"字符（2字节）。
- `int16` 代表带符号"短"字符（2字节）。
- `uint32` 代表无符号整数（4字节）。
- `int32` 代表带符号整数（4字节）。
- `uint64` 代表无符号"四字"（8字节）。
- `int64` 代表带符号"四字"（8字节）。
- `float` 代表单精确浮点（4字节）。
- `double` 代表双精确浮点（8字节）。
- `PTRINT` 代表可能含有指针的整数（不会假定PTRINT尺寸）。

能省则省

### 其它

剩下C++相关的规范内容以 [UE4代码规范](https://docs.unrealengine.com/4.27/zh-CN/ProductionPipelines/DevelopmentSetup/CodingStandard/) 为准